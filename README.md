# rbh2graph

**1. System requirements**

rbh2graph uses standard features of most Unix-like operating systems such as sed, awk, grep to generate a Cypher script to load the nodes to your own NEO4J graph database installation.

Neo4j Community Edition server v.5.20.0 was used to host the database, and Neo4j Browser v.5.15.0 was used to illustrate the data. However, neither is a dependency of rbh2graph, you can use the Cypher code that it will generate to load the node description and orthology connection files it will create to a local NEO4J installation on Linux, macOS, or Windows, or to NEO4J Sandbox online.



**2. Installation guide**

Simply download the rbh2graph repository, no installation is required:

`git clone https://github.com/FatihSarigol/rbh2graph`



**3. Demo**

rbh2graph comes with example data for testing. Simply change to the repository's directory and run the bash script as follows:

`cd rbh2graph`

`bash ./rbh2graph.sh`

For each 7 unique species, this will generate 3 files that start with the TaxID and ends with .alg .og and .species, for example: 9704.species 9704.og 9704.alg

It will also generate these 3 other files: ALGs OGs CypherCode

It should finish running only within a few seconds.



**4. Instructions for use**

Before running rbh2graph for your data, please delete the 8 example .rbh files and the taxidlineage.dmp file (which contains 10 lines of the original file from NCBI) which come together with rbh2graph for testing purposes.

Please create a new directory which contains these 3 things:

1: All of the files from rbh2graph repository on github except for the taxidlineage.dmp file and the 8 files ending with .rbh

2: All of the .rbh files that will be used in your study that are generated by this software https://github.com/conchoecia/odp in the format as seen in the example .rbh files. Please refer to the methods in our manuscript to see how to generate those files using odp.

3: The taxidlineage.dmp file from NCBI. One way to get this (which is the dictionary of the complete set of all species on NCBI mapping each TaxID to the complete set of lineage of TaxIDs) is by downloading the archive containing this file from NCBI and extracting the files from it (this worked in 2024 May, but the exact location or file name on NCBI may change in the future, the taxidlineage.dmp that comes with rbh2graph shows the format of this file as example):

`wget https://ftp.ncbi.nlm.nih.gov/pub/taxonomy/new_taxdump/new_taxdump.tar.gz; tar -xvzf new_taxdump.tar.gz`

rbh2graph can then simply be run as below:

`bash ./rbh2graph.sh`

Which will create the files that will be loaded to NEO4J, and a single Cypher script that will be used for loading the nodes, properties and connections from all of the files that will be generated. You will need to load the nodes to your own NEO4J installation by moving the files generated by rbh2graph to your NEO4J import directory, and then by running the one line code at the end of this script by applying your username, database name, password, IP and port. If you have a local NEO4J installation on your computer, or if you would like to use NEO4J Sandbox online to test a small sample set, you can still use the CypherCode file that will be created which will contain pieces of Cypher code to load each file one by one. In that case please move the files to a location that can be reached by your NEO4J instance. Please refer to NEO4J website for explanations on how to install and set up a neo4j server and cypher-shell.


Once rbh2graph finishes running, transfer all .species .og .alg files together with ALGs and OGs files to /var/lib/neo4j/import on your server (or to another directory if your import directory is defined differently in your neo4j.conf file) and run the script named CypherCode that was generated, using cypher-shell from neo4j server installation as below (change the variables defined for -u -p -d and -a based on your server and Neo4J installation):

`cypher-shell -u user -p password -d database -a neo4j://serverIP:port -f CypherCode`

Your graph database should be ready.
Please refer to our manuscript to see our graph database live and to try example queries investigating various topological questions.




If you use rbh2graph in your study, please cite our manuscript:
> Schultz, D.T., Blümel, A., Destanović, D., Sarigol, F., & Simakov, O. (2024).
> Topological mixing and irreversibility in animal chromosome evolution.
> *bioRxiv*, 2024.07.29.605683. [https://doi.org/10.1101/2024.07.29.605683](https://doi.org/10.1101/2024.07.29.605683)
